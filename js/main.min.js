const client=contentful.createClient({space:"pbrtzsa2xuet",accessToken:"yt0uClCliDLwak9_UU8QNA_4Ft2rQrQSXFCMHh2H42g"}),cartBtn=document.querySelector(".cart-btn"),closeCartBtn=document.querySelector(".close-cart"),clearCartBtn=document.querySelector(".clear-cart"),cartDOM=document.querySelector(".cart"),cartOverlay=document.querySelector(".cart-overlay"),cartItems=document.querySelector(".cart-items"),cartTotal=document.querySelector(".cart-total"),cartContent=document.querySelector(".cart-content"),productsDOM=document.querySelector(".products-center");let cart=[],buttnsDOM=[];document.addEventListener("DOMContentLoaded",()=>{const t=new UI,e=new Products;t.setupApp(),e.getProducts().then(e=>{t.displayProducts(e),Storage.saveProducts(e)}).then(()=>{t.getBagButtons(),t.cartLogic()})});const navSlide=()=>{const t=document.querySelector(".burger"),e=document.querySelector(".nav-links"),a=document.querySelectorAll(".nav-links li");t.addEventListener("click",()=>{e.classList.toggle("nav-active"),a.forEach((t,e)=>{t.style.animation?t.style.animation="":t.style.animation=`navLinkFade 0.5s ease forwards ${e/7+.5}s`}),t.classList.toggle("switch")})};navSlide();class Products{async getProducts(){try{let t=(await client.getEntries({content_type:"comfyHouseProducts"})).items;return t=t.map(t=>{const{title:e,price:a}=t.fields,{id:r}=t.sys;return{title:e,price:a,id:r,image:t.fields.image.fields.file.url}})}catch(t){console.log(t)}}}class Storage{static saveProducts(t){localStorage.setItem("products",JSON.stringify(t))}static getProduct(t){return JSON.parse(localStorage.getItem("products")).find(e=>e.id===t)}static saveCart(){localStorage.setItem("cart",JSON.stringify(cart))}static getCart(){return localStorage.getItem("cart")?JSON.parse(localStorage.getItem("cart")):[]}}class UI{displayProducts(t){let e="";t.forEach(t=>{e+=`\n    <article class="product">\n    <div class="img-container">\n      <img src=${t.image} alt="product" class="product-img">\n      <button class="bag-btn" data-id=${t.id}>\n        <i class="fas fa-shopping-cart" aria-hidden="true"></i>\n        add to cart \n      </button>\n    </div>\n    <h3>${t.title}</h3>\n    <h4>$${t.price}</h4>\n  </article>`}),productsDOM.innerHTML=e}getBagButtons(){const t=[...document.querySelectorAll(".bag-btn")];buttnsDOM=t,t.forEach(t=>{let e=t.dataset.id;cart.find(t=>t.id==e)&&(t.innerText="In Cart",t.disabled=!0),t.addEventListener("click",t=>{t.target.innerText="In Cart",t.target.disabled=!0;let a={...Storage.getProduct(e),amount:1};cart=[...cart,a],Storage.saveCart(cart),this.setCartValues(cart),this.addCartItem(a),this.showCart()})})}setCartValues(t){let e=0,a=0;t.map(t=>{e+=t.price*t.amount,a+=t.amount}),cartTotal.innerText=parseFloat(e.toFixed(2)),cartItems.innerText=a}addCartItem(t){const e=document.createElement("div");e.classList.add("cart-item"),e.innerHTML=`\n      <img src= ${t.image} alt="product">\n        <div>\n          <h4>${t.title}</h4>\n          <h5>$${t.price}</h5>\n          <span class="remove-item" data-id=${t.id}>remove</span>\n        </div>\n        <div>\n          <i class="fas fa-chevron-up" data-id=${t.id}></i>\n            <p class="item-amount">${t.amount}</p>\n          <i class="fas fa-chevron-down" data-id=${t.id}></i>\n        </div>`,cartContent.appendChild(e)}showCart(){cartOverlay.classList.add("transparentBcg"),cartDOM.classList.add("showCart")}setupApp(){cart=Storage.getCart(),this.setCartValues(cart),this.populateCart(cart),cartBtn.addEventListener("click",this.showCart),closeCartBtn.addEventListener("click",this.hideCart)}populateCart(t){t.forEach(t=>this.addCartItem(t))}hideCart(){cartOverlay.classList.remove("transparentBcg"),cartDOM.classList.remove("showCart")}cartLogic(){clearCartBtn.addEventListener("click",()=>{this.clearCart()}),cartContent.addEventListener("click",t=>{if(t.target.classList.contains("remove-item")){let e=t.target,a=e.dataset.id;cartContent.removeChild(e.parentElement.parentElement),this.removeItem(a)}else if(t.target.classList.contains("fa-chevron-up")){let e=t.target,a=e.dataset.id,r=cart.find(t=>t.id===a);r.amount=r.amount+1,Storage.saveCart(cart),this.setCartValues(cart),e.nextElementSibling.innerText=r.amount}else if(t.target.classList.contains("fa-chevron-down")){let e=t.target,a=e.dataset.id,r=cart.find(t=>t.id===a);r.amount=r.amount-1,r.amount>0?(Storage.saveCart(cart),this.setCartValues(cart),e.previousElementSibling.innerText=r.amount):(cartContent.removeChild(e.parentElement.parentElement),this.removeItem(a)),Storage.saveCart(cart),this.setCartValues(cart),addAmount.nextElementSibling.innerText=r.amount}})}clearCart(){for(cart.map(t=>t.id).forEach(t=>this.removeItem(t));cartContent.children.length>0;)cartContent.removeChild(cartContent.children[0]);this.hideCart()}removeItem(t){cart=cart.filter(e=>e.id!==t),this.setCartValues(cart),Storage.saveCart(cart);let e=this.getSingleButton(t);e.disabled=!1,e.innerHTML='<i class= "fas fa-shopping-cart"></i>add to cart'}getSingleButton(t){return buttnsDOM.find(e=>e.dataset.id===t)}}